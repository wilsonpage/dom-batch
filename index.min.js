!function(t){"use strict";function e(){var t=this;t.frames=[],t.lastId=0,t.rAF=n,t.batch={hash:{},read:[],write:[],mode:null}}var r=window,n=r.requestAnimationFrame||r.webkitRequestAnimationFrame||r.mozRequestAnimationFrame||r.msRequestAnimationFrame||function(t){return r.setTimeout(t,1e3/60)};e.prototype.read=function(t,e){var r=this,n=r.add("read",t,e),o=n.id;return r.batch.read.push(o),"reading"===r.batch.mode||r.batch.scheduled||r.scheduleBatch(),o},e.prototype.write=function(t,e){var r=this,n=r.add("write",t,e),o=r.batch.mode,a=n.id;return r.batch.write.push(a),"writing"===o||"reading"===o||r.batch.scheduled||r.scheduleBatch(),a},e.prototype.defer=function(t,e,r){"function"==typeof t&&(r=e,e=t,t=1);var n=this,o=t-1;return n.schedule(o,function(){n.run({fn:e,ctx:r})})},e.prototype.clear=function(t){var e=this;if("function"==typeof t)return e.clearFrame(t);t=Number(t);var r=e.batch.hash[t];if(r){var n=e.batch[r.type],o=n.indexOf(t);delete e.batch.hash[t],~o&&n.splice(o,1)}},e.prototype.clearFrame=function(t){var e=this.frames.indexOf(t);~e&&this.frames.splice(e,1)},e.prototype.scheduleBatch=function(){var t=this;t.schedule(0,function(){t.batch.scheduled=!1,t.runBatch()}),t.batch.scheduled=!0},e.prototype.uniqueId=function(){return++this.lastId},e.prototype.flush=function(t){for(var e;e=t.shift();)this.run(this.batch.hash[e])},e.prototype.runBatch=function(){var t=this;try{t.batch.mode="reading",t.flush(t.batch.read),t.batch.mode="writing",t.flush(t.batch.write),t.batch.mode=null}catch(e){throw t.runBatch(),e}},e.prototype.add=function(t,e,r){var n=this.uniqueId();return this.batch.hash[n]={id:n,fn:e,ctx:r,type:t}},e.prototype.run=function(t){var e=this,r=t.ctx||e,n=t.fn;if(delete e.batch.hash[t.id],!e.onError)return n.call(r);try{n.call(r)}catch(o){e.onError(o)}},e.prototype.loop=function(){var t=this,e=t.rAF;t.looping||(e(function r(){var n=t.frames.shift();t.frames.length?e(r):t.looping=!1,n&&n()}),t.looping=!0)},e.prototype.schedule=function(t,e){var r=this;return r.frames[t]?r.schedule(t+1,e):(r.loop(),r.frames[t]=e)},t=t||new e,"undefined"!=typeof module&&module.exports?module.exports=t:"function"==typeof define&&define.amd?define(function(){return t}):r.fastdom=t}(window.fastdom);